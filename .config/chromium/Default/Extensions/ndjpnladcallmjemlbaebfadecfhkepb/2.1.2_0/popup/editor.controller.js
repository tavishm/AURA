!function(){"use strict";angular.module("app.editor",[]).controller("EditorController",["$scope","$log","constants","storage","userService","localize","editorUtils",function(e,t,i,r,n,o,a){var d=this,l="editorClientState",s="courtesyShutdown",c="enableEditor",u="enableSpelling",E="enableGrammar",S="enableRefinements",b="userExcludedUrls",g="disabledWebSites",m=Object.freeze({undefined:0,enabled:1,disabled:2});function U(e){d.currentTabUrl=e.url,d.currentHostName=e.hostname,d.editorDisableShow=!1,d.editorEnableShow=!1,d.editorSiteBlockedShow=!1,d.currentHostName&&(d.editorSiteBlockedShow=a.siteIsBlocked(d.currentTabUrl),d.editorIsBlockedLabel=a.getFormattedLocalizedString("EditorIsBlockedOnThisSiteLabel",d.currentHostName),d.editorSiteBlockedShow||d.storage.get([b,g]).then((function(e){var t=d.currentHostName;d.userExcludedUrls=a.readSettingValueOrUndefined(e,b),d.disabledWebSites=a.readSettingValueOrUndefined(e,g),d.editorDisableLabel=a.getFormattedLocalizedString("DisableEditorOnThisSiteLabel",t),d.editorEnableLabel=a.getFormattedLocalizedString("EnableEditorOnThisSiteLabel",t),d.editorIsDisabledLabel=a.getFormattedLocalizedString("EditorIsDisabledOnThisSiteLabel",t);var i=a.isHostNameExcluded(d.currentTabUrl,t,d.userExcludedUrls,d.disabledWebSites);d.editorDisableShow=!i,d.editorEnableShow=i})))}function f(){t.trackEvent("EditorUserInteraction",{name:"SpellingChange"}),a.writeEditorSettingValue(u,d.editorSpelling)}function h(){t.trackEvent("EditorUserInteraction",{name:"GrammarChange"}),a.writeEditorSettingValue(E,d.editorGrammar)}function v(){t.trackEvent("EditorUserInteraction",{name:"RefinementsChange"}),a.writeEditorSettingValue(S,d.editorRefinements)}function k(){t.trackEvent("EditorUserInteraction",{name:"TurnOnClick"}),a.writeEditorSettingValue(c,!0),d.editorEnabled=!0}function w(){t.trackEvent("EditorUserInteraction",{name:"SettingsClick"}),a.openOptionsPage()}function C(){t.trackEvent("EditorUserInteraction",{name:"DisableClick"});var e=a.getHostnameOnlyUrl(d.currentTabUrl);e&&(d.userExcludedUrls.push(e),a.writeEditorSettingValue(b,d.userExcludedUrls),d.editorDisableShow=!1,d.editorEnableShow=!0)}function O(){t.trackEvent("EditorUserInteraction",{name:"EnableClick"}),d.userExcludedUrls=d.userExcludedUrls.filter((function(e){return a.getUrlInfo(e).hostname!==d.currentHostName})),a.writeEditorSettingValue(b,d.userExcludedUrls),d.editorDisableShow=!0,d.editorEnableShow=!1}function I(){t.trackEvent("EditorUserInteraction",{name:"GoPremiumClick"}),Utilities.navigateToUrlWithNewTab(d.constants.LINKS.EDITOR_GO_PREMIUM_URL,!0)}d.onLoad=function(){t.debug("Loading EditorController"),d.storage.get([l,s,c,u,E,S]).then((function(e){var t=a.readSettingValueOrUndefined(e,l);if(void 0!==t&&(d.editorAvailable=t===m.enabled),d.editorAvailable){var i=a.readSettingValueOrUndefined(e,s);void 0!==i&&(d.editorAvailable=!i)}var r=a.readSettingValueOrUndefined(e,c);void 0!==r&&(d.editorEnabled=r);var n=a.readSettingValueOrUndefined(e,u);void 0!==n&&(d.editorSpelling=n);var o=a.readSettingValueOrUndefined(e,E);void 0!==o&&(d.editorGrammar=o);var b=a.readSettingValueOrUndefined(e,S);void 0!==b&&(d.editorRefinements=b)})),a.getCurrentTabHostName().then(U)},d.constants=i,d.storage=r,d.userService=n,d.localize=o,d.editorAvailable=!1,d.editorDisableShow=!1,d.editorEnableShow=!1,d.editorShowUpsell=!1,d.editorSiteBlockedShow=!1,d.editorEnabled=!0,d.editorSpelling=!0,d.editorGrammar=!0,d.editorRefinements=!0,d.onEditorTurnOnClick=k,d.onEditorSettingsClick=w,d.onEditorDisableClick=C,d.onEditorEnableClick=O,d.onEditorGoPremiumClick=I,d.onEditorSpellingChange=f,d.onEditorGrammarChange=h,d.onEditorRefinementsChange=v}])}();